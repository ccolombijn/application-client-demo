"use strict";const application=function(){let e,t,n,a,o,i,l,p,r,c,s={},d=0;const u={template:"pageLayout",templatePath:"html/templates/{template}.html",modulesPath:"js/modules/{module}.js"},m=(e,t)=>{const n=new Date;$.get(`js/${e}.js`).done(()=>{const a=new Date;debug(`application.require : js/${e}.js load complete in ${a-n} ms`),t&&t()}).fail(()=>{throw`application.require : ${e} not available`})},f=()=>location.hash.slice(1),g=()=>f()?y().endpoint:e.default,h={},b=()=>{m(`modules/${s.modules[d]}`,()=>{debug(`application.initModules : modules/${s.modules[d]} loaded`),d===s.modules.length-1?(o=new Date,l=o-n,application.loadtime=l,debug(`application.initModules complete in ${l} ms: init load`),j(()=>{i=new Date,p=i-a,application.object[y().endpoint].loadtime=p}),$(window).on("hashchange",()=>j(()=>{}))):(d++,b())})},w=(t=>(n=new Date,(e=>{if(e&&s)if("function"==typeof e)e();else for(let t in s)s[t]||(s[t]=e[t]);else e&&(s=e)})(void 0),(t=>{$.get("json/config.json",t=>{e=t,s.config=e,s.default=e.default,s.modules=e.modules,s.routes=e.routes}).done(()=>{}).fail(()=>{if(!s.config)throw"initConfig : config not defined";e=s.config}).always(()=>{t&&t()})})(()=>{m("debug",()=>{debug(`application.init : ${e.name}`),e.modules?(r=new Set(e.modules).values(),e.require?((e,t)=>{if(e.length>0){for(let t of e)m(t,()=>{application.requireCallback&&(application.requireCallback(),application.requireCallback=void 0)});t&&t()}else m(e,t)})(e.require,()=>{b(r)}):b(r)):(console.warn("config.modules is undefined"),setTimeout(()=>j(),500),window.addEventListener("hashchange",()=>j())),application.config=e})}),s))(),y=e=>{let t,n;(e=e||f())||(e=g());const a=Object.getOwnPropertyNames(s.routes);for(let o of a)if(e.includes(o)){t=e!=o?e.replace(`${o}/`,""):null,n=s.routes[o].split(".");break}return{parameter:t,endpoint:n}},j=e=>{let t;a=new Date,"function"==typeof e&&(t=e,e=y()),e||(e=y());const n=e.endpoint;if(!n)throw"application.moduleRouter : endpoint undefined";{const t=n[1]?s[n[0]][n[1]]:s[n[0]].default;g[2]&&(t=n[3]?t[n[2]][n[3]]:t[n[2]].default),v(()=>{if("function"!=typeof t)throw`application.moduleRouter  : ${typeof R} ${R} is not a function`;t(e.parameter),debug(`application.moduleRouter : ${s.routes[g()]} : ${n.join(".")}`)})}t&&t()},v=n=>($(e.main).fadeOut(400,()=>{D(()=>{debug(`application.page : ${e.main} #${D()}`),n&&n(),O("page"),E.main.fadeIn()})}),t),P={},D=(t,n,a)=>{"function"==typeof t&&(a=t,t=y().endpoint,n=!0),t||(t=y().endpoint),e.template||(e.template=u.template);let o,i=application.object[t];if(o=i.template?i.template:e.template,P[o])n&&(o=P[o],E.main.html(o),a&&a());else{e.templatePath||(e.templatePath=u.templatePath);e.templatePath.replace("{template}",o);let t=new Date;$.get(`html/templates/${o}.html`,function(a){let i=new Date;debug(`application.template : html/templates/${o}.html load complete in ${i-t} ms`),P[o]=a,n&&$(e.main).html(a)}).done(()=>{a&&a()})}return o},O=(n,o)=>{let l,r="";"function"==typeof n?(o=n,l=y().endpoint):n&&(a=new Date,n.target?n.target.id?r=`(#${n.target.id} ${n.type} event)`:n.target.class&&(r=`(.${n.target.class} ${n.type} event)`):"string"==typeof n&&(r=`(${n})`),l=y().endpoint),l||(l=y().endpoint);let d=D(l),u=application.object[l];$(`#${d} h2`).html(u.name),k(l),(()=>{const t=(e,t)=>"string"==typeof e[t]&&e[t].includes("#");(n=>{for(let n in e)t(e,n)&&(h[n]=$(e[n]))})(),debug(`application.elements : ${Object.getOwnPropertyNames(h).join(",")}`)})(),e.nav&&q();for(let e in s[l])if("string"==typeof s[l][e]){const t=$(`#${d} .${e}`);t&&(t.html(M(s[l][e])),t.length>0&&debug(`application.render : updated ${t.length} elements with class .${e}`)),$(`[data-property*='${e}']`)&&$(`[data-property*='${e}']`).html(M(s[l][e]))}t=$(`#${d}`).html(),c=application.object,o&&o();for(let e in x)x[e]();return i=new Date,p=i-a,u.loadtime=p,debug(`application.render ${r}: ${l} complete in ${p} ms`),e.debug&&application.debugger(),application},q=()=>{const t=e.navMenuItemPrefix?e.navMenuItemPrefix:"#";E.nav.html("");for(let e of N()){let n=$("<li></li>").attr("id",e).html(`<a href="${t}${e}">\n                  ${M(s[e].name)}\n                </a>`);E.nav.append(n)}let n=y().endpoint,a=N().join(",").replace(n,`${n}(active)`);debug(`application.nav : ${a}`);const o=`${e.nav} li#${n} a`;return $(o).addClass("active"),e.style&&s[n].color&&$(o).attr("style",`${M(e.style)}`),E.nav},k=t=>{t||(t=y().endpoint);let n=""===t?e.name:`${s[t].name} - ${e.name}`;return $("title").html(n),debug(`application.title : ${n}`),n},C=(e,t,n)=>{if("string"==typeof e&&(e=h[e]?h[e]:$(e)),"string"==typeof n){let t=n,a=t.includes(".")?s[t.split(".")[0]][t.split(".")[1]]:s[y().endpoint][t];e.val(a),n=(e=>{t.includes(".")?s[t.split(".")[0]][t.split(".")[1]]=e.target.value:R()[t]=e.target.value})}else if("object"==typeof n){const e=n;n=(t=>{if(e.api&&$.ajax(e).done(()=>e.callback()),t.target.class){const n=t.target.class;t.target.value&&(e[n]=t.target.value)}})}let o;return e&&(o=e.attr("id"),e.on(t,e=>{a=new Date,n(e),O(e)})),o?x[o]:x},x={},N=function(){let e;e=[];for(let t of Object.getOwnPropertyNames(application.object)){"function"==typeof s[t].default&&e.push(t)}return e},R=e=>e?s[e]:s[y().endpoint],M=e=>{const t=y().endpoint,n=Object.getOwnPropertyNames(application.object[t]);for(let a of n)"string"==typeof application.object[t][a]&&(e=e.replace(new RegExp(`{${a}}`,"g"),application.object[t][a]));const a=Object.getOwnPropertyNames(u);for(let t of a)e=e.replace(new RegExp(`{${t}}`,"g"),u[t]);return e},E=h;return{route:()=>f().split("/"),endpoint:g,object:s,model:{},modules:N,module:R,config:e,require:m,requireCallback:void 0,add:function(e,t){if(e.includes(".")?(e=e.split("."))[1]?s[e[0]][e[1]]=t:s[e[0]]=t:t?s[e]=t:m(e),t.route?s.routes[t.route]=e:t&&(s.routes[e.replace(".","/")]=e),t)return t},remove:function(e){const t={};for(let n in s)n!=e&&(t[n]=n);s=t},init:w,load:j,event:C,controller:(e,t,n)=>{C(e,t,n)},render:O,page:v,nav:q,element:h,view:E,template:D,templates:P,title:k,debug:[]}}();
